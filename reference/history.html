<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>历史记录 - 林雨晴的生活日志</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;600&family=Noto+Serif+SC:wght@400;600&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    
    <!-- Animation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.0/echarts.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #8B7355;
            --secondary-color: #A0937D;
            --accent-color: #D4B896;
            --bg-color: #F5F1EB;
            --text-primary: #3A372E;
            --text-secondary: #6B6659;
            --border-color: #E0DACE;
            --shadow-color: rgba(139, 115, 85, 0.15);
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .font-serif {
            font-family: 'Noto Serif SC', serif;
        }
        
        .bg-paper {
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(139, 115, 85, 0.05) 1px, transparent 0);
            background-size: 20px 20px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px var(--shadow-color);
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--accent-color);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100%;
        }
        
        .filter-btn {
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .log-entry {
            border-left: 3px solid var(--accent-color);
            transition: all 0.3s ease;
        }
        
        .log-entry:hover {
            border-left-color: var(--primary-color);
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .mood-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .chart-container {
            height: 300px;
            margin: 1rem 0;
        }
        
        .small-chart {
            height: 200px;
        }
        
        .time-display {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 0.375rem;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover:not(:disabled) {
            background-color: var(--accent-color);
            color: white;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination button.active {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body class="bg-paper">
    <!-- Navigation -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center">
                        <span class="text-white font-bold text-sm">雨</span>
                    </div>
                    <span class="font-serif text-xl font-semibold text-gray-800">雨晴小筑</span>
                </div>
                
                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="nav-link text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium">实时日志</a>
                    <a href="history.html" class="nav-link active text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium">历史记录</a>
                    <a href="about.html" class="nav-link text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium">关于项目</a>
                </div>
                
                <!-- Time Display -->
                <div class="time-display">
                    <span id="current-time"></span>
                </div>
                
                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-gray-700 hover:text-gray-900">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white/95 backdrop-blur-md border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="index.html" class="block px-3 py-2 text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-md">实时日志</a>
                <a href="history.html" class="block px-3 py-2 text-base font-medium text-gray-900 bg-gray-100 rounded-md">历史记录</a>
                <a href="about.html" class="block px-3 py-2 text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 rounded-md">关于项目</a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="font-serif text-3xl font-semibold text-gray-800 mb-2">历史记录</h1>
            <p class="text-gray-600">浏览林雨晴过往的行为日志和统计分析</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            
            <!-- Left Sidebar - Filters & Stats -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Date Filter -->
                <div class="card rounded-xl p-6">
                    <h3 class="font-medium text-gray-800 mb-4">日期筛选</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">开始日期</label>
                            <input type="date" id="start-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">结束日期</label>
                            <input type="date" id="end-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        <button id="apply-filter" class="w-full bg-amber-500 text-white py-2 rounded-lg hover:bg-amber-600 transition-colors">
                            应用筛选
                        </button>
                    </div>
                </div>
                
                <!-- Activity Filter -->
                <div class="card rounded-xl p-6">
                    <h3 class="font-medium text-gray-800 mb-4">活动类型</h3>
                    <div class="space-y-2">
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm active" data-filter="all">
                            全部活动
                        </button>
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm" data-filter="creative">
                            创作活动
                        </button>
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm" data-filter="work">
                            工作活动
                        </button>
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm" data-filter="personal">
                            个人活动
                        </button>
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm" data-filter="social">
                            社交活动
                        </button>
                    </div>
                </div>
                
                <!-- Mood Filter -->
                <div class="card rounded-xl p-6">
                    <h3 class="font-medium text-gray-800 mb-4">心情状态</h3>
                    <div class="space-y-2">
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm active" data-mood="all">
                            全部心情
                        </button>
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm" data-mood="happy">
                            积极心情
                        </button>
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm" data-mood="calm">
                            平静心情
                        </button>
                        <button class="filter-btn w-full text-left px-3 py-2 rounded-lg text-sm" data-mood="thoughtful">
                            沉思心情
                        </button>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="card rounded-xl p-6">
                    <h3 class="font-medium text-gray-800 mb-4">统计概览</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">总日志数</span>
                            <span id="total-logs-count" class="font-medium">0</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">筛选结果</span>
                            <span id="filtered-count" class="font-medium">0</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">平均心情</span>
                            <span id="avg-mood" class="font-medium">良好</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">活跃时段</span>
                            <span id="active-period" class="font-medium">下午</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Charts Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Activity Distribution Chart -->
                    <div class="card rounded-xl p-6">
                        <h3 class="font-medium text-gray-800 mb-4">活动分布</h3>
                        <div id="activity-chart" class="small-chart"></div>
                    </div>
                    
                    <!-- Mood Trends Chart -->
                    <div class="card rounded-xl p-6">
                        <h3 class="font-medium text-gray-800 mb-4">心情趋势</h3>
                        <div id="mood-trends-chart" class="small-chart"></div>
                    </div>
                </div>
                
                <!-- Time Pattern Chart -->
                <div class="card rounded-xl p-6">
                    <h3 class="font-medium text-gray-800 mb-4">时间模式分析</h3>
                    <div id="time-pattern-chart" class="chart-container"></div>
                </div>
                
                <!-- Weather Impact Chart -->
                <div class="card rounded-xl p-6">
                    <h3 class="font-medium text-gray-800 mb-4">天气影响分析</h3>
                    <div id="weather-impact-chart" class="chart-container"></div>
                </div>
                
                <!-- Logs List -->
                <div class="card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-medium text-gray-800">日志列表</h3>
                        <div class="flex items-center space-x-2">
                            <button id="export-btn" class="text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded hover:bg-gray-200 transition-colors">
                                导出数据
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search Box -->
                    <div class="mb-4">
                        <input type="text" id="search-input" placeholder="搜索日志内容..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500">
                    </div>
                    
                    <!-- Logs Container -->
                    <div id="logs-container" class="space-y-4 max-h-96 overflow-y-auto">
                        <!-- Logs will be dynamically inserted here -->
                    </div>
                    
                    <!-- Pagination -->
                    <div id="pagination" class="pagination">
                        <!-- Pagination buttons will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-white/50 backdrop-blur-sm border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-sm text-gray-600">
                <p>&copy; 2026 雨晴小筑 - 虚拟人物行为日志生成器</p>
                <p class="mt-1">探索数字时代的人性观察与记录</p>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // 历史页面控制器
        class HistoryManager {
            constructor() {
                this.allLogs = [];
                this.filteredLogs = [];
                this.currentPage = 1;
                this.logsPerPage = 10;
                this.currentFilters = {
                    activityType: 'all',
                    moodType: 'all',
                    startDate: null,
                    endDate: null,
                    searchTerm: ''
                };
                
                this.charts = {};
                this.elements = {};
                
                this.init();
            }
            
            async init() {
                this.initElements();
                await this.loadHistoryData();
                this.initEventListeners();
                this.initCharts();
                this.renderLogs();
                this.updateCharts();
                this.updateStats();
                
                // 启动时间更新
                this.updateTimeDisplay();
                setInterval(() => this.updateTimeDisplay(), 1000);
            }
            
            initElements() {
                this.elements = {
                    currentTime: document.getElementById('current-time'),
                    startDate: document.getElementById('start-date'),
                    endDate: document.getElementById('end-date'),
                    applyFilter: document.getElementById('apply-filter'),
                    filterBtns: document.querySelectorAll('.filter-btn'),
                    searchInput: document.getElementById('search-input'),
                    exportBtn: document.getElementById('export-btn'),
                    logsContainer: document.getElementById('logs-container'),
                    pagination: document.getElementById('pagination'),
                    totalLogsCount: document.getElementById('total-logs-count'),
                    filteredCount: document.getElementById('filtered-count'),
                    avgMood: document.getElementById('avg-mood'),
                    activePeriod: document.getElementById('active-period')
                };
            }
            
            initEventListeners() {
                // 日期筛选
                this.elements.applyFilter.addEventListener('click', () => {
                    this.currentFilters.startDate = this.elements.startDate.value;
                    this.currentFilters.endDate = this.elements.endDate.value;
                    this.applyFilters();
                });
                
                // 活动类型筛选
                this.elements.filterBtns.forEach(btn => {
                    if (btn.dataset.filter) {
                        btn.addEventListener('click', () => {
                            this.setActiveFilter(btn, 'filter');
                            this.currentFilters.activityType = btn.dataset.filter;
                            this.applyFilters();
                        });
                    } else if (btn.dataset.mood) {
                        btn.addEventListener('click', () => {
                            this.setActiveFilter(btn, 'mood');
                            this.currentFilters.moodType = btn.dataset.mood;
                            this.applyFilters();
                        });
                    }
                });
                
                // 搜索
                this.elements.searchInput.addEventListener('input', (e) => {
                    this.currentFilters.searchTerm = e.target.value.toLowerCase();
                    this.applyFilters();
                });
                
                // 导出数据
                this.elements.exportBtn.addEventListener('click', () => {
                    this.exportData();
                });
            }
            
            setActiveFilter(activeBtn, type) {
                const selector = type === 'filter' ? '[data-filter]' : '[data-mood]';
                this.elements.filterBtns.forEach(btn => {
                    if (btn.matches(selector)) {
                        btn.classList.remove('active');
                    }
                });
                activeBtn.classList.add('active');
            }
            
            async loadHistoryData() {
                try {
                    // 从localStorage加载数据
                    const savedLogs = localStorage.getItem('virtual-character-logs');
                    if (savedLogs) {
                        this.allLogs = JSON.parse(savedLogs);
                    } else {
                        // 如果没有保存的数据，生成一些示例数据
                        this.allLogs = this.generateSampleLogs();
                    }
                    
                    this.filteredLogs = [...this.allLogs];
                    this.elements.totalLogsCount.textContent = this.allLogs.length;
                    
                } catch (error) {
                    console.error('加载历史数据失败:', error);
                    this.allLogs = this.generateSampleLogs();
                    this.filteredLogs = [...this.allLogs];
                }
            }
            
            generateSampleLogs() {
                const sampleLogs = [];
                const activities = [
                    '绘画水彩画', '写随笔日记', '阅读诗歌集', '设计插画',
                    '准备咖啡', '整理店面', '接待顾客', '冥想思考',
                    '浇花养草', '听音乐', '泡茶品茗', '散步'
                ];
                
                const moods = [
                    '平静', '愉悦', '沉思', '安详', '放松', '专注', '满足'
                ];
                
                const locations = ['雨晴小筑', '阳台', '公园', '家中'];
                
                // 生成过去7天的数据
                for (let i = 0; i < 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    
                    // 每天生成3-8条日志
                    const logsPerDay = Math.floor(Math.random() * 6) + 3;
                    
                    for (let j = 0; j < logsPerDay; j++) {
                        const logTime = new Date(date);
                        logTime.setHours(Math.floor(Math.random() * 16) + 6); // 6-22点
                        logTime.setMinutes(Math.floor(Math.random() * 60));
                        
                        const activity = activities[Math.floor(Math.random() * activities.length)];
                        const mood = moods[Math.floor(Math.random() * moods.length)];
                        const location = locations[Math.floor(Math.random() * locations.length)];
                        
                        sampleLogs.push({
                            id: `log_${i}_${j}`,
                            timestamp: logTime.toISOString(),
                            activity: {
                                name: activity,
                                type: this.getActivityType(activity),
                                location: location,
                                description: this.generateActivityDescription(activity)
                            },
                            mood: {
                                primary: mood,
                                intensity: Math.floor(Math.random() * 5) + 5
                            },
                            thoughts: this.generateThought(activity, mood),
                            weather: {
                                condition: ['晴', '多云', '阴', '雨'][Math.floor(Math.random() * 4)],
                                temperature: Math.floor(Math.random() * 20) + 5
                            }
                        });
                    }
                }
                
                return sampleLogs.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            }
            
            getActivityType(activity) {
                const creativeActivities = ['绘画水彩画', '写随笔日记', '阅读诗歌集', '设计插画'];
                const workActivities = ['准备咖啡', '整理店面', '接待顾客'];
                const personalActivities = ['冥想思考', '浇花养草', '听音乐', '泡茶品茗', '散步'];
                
                if (creativeActivities.includes(activity)) return 'creative';
                if (workActivities.includes(activity)) return 'work';
                if (personalActivities.includes(activity)) return 'personal';
                return 'personal';
            }
            
            generateActivityDescription(activity) {
                const descriptions = {
                    '绘画水彩画': '在柔和的灯光下，专注地调配着色彩',
                    '写随笔日记': '笔尖在纸上轻轻滑动，记录生活的点滴',
                    '阅读诗歌集': '沉浸在诗意的美好中，感受文字的韵律',
                    '设计插画': '为新的项目创作精美的插画作品',
                    '准备咖啡': '为客人准备香醇的咖啡，香气弥漫整个空间',
                    '整理店面': '仔细整理咖啡馆的每一个角落',
                    '接待顾客': '微笑着迎接每一位顾客，分享温暖的故事',
                    '冥想思考': '在宁静中让思绪自由流淌',
                    '浇花养草': '细心照料阳台上的每一株植物',
                    '听音乐': '让优美的旋律抚慰心灵',
                    '泡茶品茗': '品味茶香，享受片刻的宁静',
                    '散步': '在公园小径上悠闲地散步'
                };
                
                return descriptions[activity] || '正在进行日常活动';
            }
            
            generateThought(activity, mood) {
                const thoughts = [
                    '生活的美好往往藏在平凡的细节中',
                    '每一个瞬间都值得用心体会',
                    '在安静中寻找内心的声音',
                    '创造让生活变得更加丰富多彩',
                    '与人为善，世界也会温柔以待'
                ];
                
                return thoughts[Math.floor(Math.random() * thoughts.length)];
            }
            
            applyFilters() {
                this.filteredLogs = this.allLogs.filter(log => {
                    // 日期筛选
                    if (this.currentFilters.startDate && this.currentFilters.endDate) {
                        const logDate = new Date(log.timestamp).toDateString();
                        const startDate = new Date(this.currentFilters.startDate).toDateString();
                        const endDate = new Date(this.currentFilters.endDate).toDateString();
                        
                        if (logDate < startDate || logDate > endDate) {
                            return false;
                        }
                    }
                    
                    // 活动类型筛选
                    if (this.currentFilters.activityType !== 'all') {
                        if (log.activity.type !== this.currentFilters.activityType) {
                            return false;
                        }
                    }
                    
                    // 心情筛选
                    if (this.currentFilters.moodType !== 'all') {
                        const moodCategory = this.getMoodCategory(log.mood.primary);
                        if (moodCategory !== this.currentFilters.moodType) {
                            return false;
                        }
                    }
                    
                    // 搜索筛选
                    if (this.currentFilters.searchTerm) {
                        const searchContent = `${log.activity.name} ${log.activity.description} ${log.thoughts}`.toLowerCase();
                        if (!searchContent.includes(this.currentFilters.searchTerm)) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                this.currentPage = 1;
                this.renderLogs();
                this.updateCharts();
                this.updateStats();
            }
            
            getMoodCategory(mood) {
                const happyMoods = ['愉悦', '兴奋', '满足', '欣喜'];
                const calmMoods = ['平静', '安详', '放松', '舒适', '专注'];
                const thoughtfulMoods = ['沉思', '忧郁', '敏感', '内省'];
                
                if (happyMoods.includes(mood)) return 'happy';
                if (calmMoods.includes(mood)) return 'calm';
                if (thoughtfulMoods.includes(mood)) return 'thoughtful';
                return 'calm';
            }
            
            renderLogs() {
                const container = this.elements.logsContainer;
                container.innerHTML = '';
                
                const startIndex = (this.currentPage - 1) * this.logsPerPage;
                const endIndex = startIndex + this.logsPerPage;
                const pageLogs = this.filteredLogs.slice(startIndex, endIndex);
                
                pageLogs.forEach(log => {
                    const logElement = this.createLogElement(log);
                    container.appendChild(logElement);
                });
                
                this.renderPagination();
                
                // 添加动画
                anime({
                    targets: '.log-entry',
                    translateY: [20, 0],
                    opacity: [0, 1],
                    duration: 600,
                    delay: anime.stagger(100),
                    easing: 'easeOutQuart'
                });
            }
            
            createLogElement(log) {
                const logDiv = document.createElement('div');
                logDiv.className = 'log-entry bg-white/70 backdrop-blur-sm rounded-lg p-4 border-l-4 border-amber-400 hover:bg-white/80 transition-all duration-300';
                
                const time = new Date(log.timestamp);
                const timeString = time.toLocaleString('zh-CN', { 
                    year: 'numeric', 
                    month: '2-digit', 
                    day: '2-digit',
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                // 心情指示器颜色
                const moodColors = {
                    '愉悦': 'bg-green-400', '兴奋': 'bg-yellow-400', '满足': 'bg-blue-400',
                    '平静': 'bg-gray-400', '安详': 'bg-purple-400', '放松': 'bg-indigo-400',
                    '沉思': 'bg-amber-400', '忧郁': 'bg-slate-400', '敏感': 'bg-pink-400',
                    '内省': 'bg-teal-400', '专注': 'bg-cyan-400'
                };
                
                const moodColor = moodColors[log.mood.primary] || 'bg-gray-400';
                
                logDiv.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <div class="flex items-center space-x-2">
                            <span class="mood-indicator ${moodColor}"></span>
                            <span class="text-sm font-medium text-gray-800">${log.mood.primary}</span>
                            <span class="text-xs text-gray-500">${timeString}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            ${log.weather ? `<span class="text-xs text-gray-500">${log.weather.condition}</span>` : ''}
                            <span class="text-xs text-gray-500">·</span>
                            <span class="text-xs text-gray-500">${log.activity.location}</span>
                        </div>
                    </div>
                    
                    <div class="mb-2">
                        <h4 class="font-medium text-gray-800 mb-1">${log.activity.name}</h4>
                        <p class="text-sm text-gray-600 leading-relaxed">${log.activity.description}</p>
                    </div>
                    
                    <div class="bg-amber-50 border border-amber-100 rounded p-3">
                        <p class="text-sm text-amber-800 italic">"${log.thoughts}"</p>
                    </div>
                `;
                
                return logDiv;
            }
            
            renderPagination() {
                const totalPages = Math.ceil(this.filteredLogs.length / this.logsPerPage);
                const pagination = this.elements.pagination;
                pagination.innerHTML = '';
                
                if (totalPages <= 1) return;
                
                // 上一页按钮
                const prevBtn = document.createElement('button');
                prevBtn.textContent = '上一页';
                prevBtn.disabled = this.currentPage === 1;
                prevBtn.addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.renderLogs();
                    }
                });
                pagination.appendChild(prevBtn);
                
                // 页码按钮
                for (let i = 1; i <= totalPages; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    pageBtn.className = i === this.currentPage ? 'active' : '';
                    pageBtn.addEventListener('click', () => {
                        this.currentPage = i;
                        this.renderLogs();
                    });
                    pagination.appendChild(pageBtn);
                }
                
                // 下一页按钮
                const nextBtn = document.createElement('button');
                nextBtn.textContent = '下一页';
                nextBtn.disabled = this.currentPage === totalPages;
                nextBtn.addEventListener('click', () => {
                    if (this.currentPage < totalPages) {
                        this.currentPage++;
                        this.renderLogs();
                    }
                });
                pagination.appendChild(nextBtn);
            }
            
            initCharts() {
                this.initActivityChart();
                this.initMoodTrendsChart();
                this.initTimePatternChart();
                this.initWeatherImpactChart();
            }
            
            updateCharts() {
                this.updateActivityChart();
                this.updateMoodTrendsChart();
                this.updateTimePatternChart();
                this.updateWeatherImpactChart();
            }
            
            initActivityChart() {
                this.charts.activity = echarts.init(document.getElementById('activity-chart'));
            }
            
            updateActivityChart() {
                const activityCount = {};
                this.filteredLogs.forEach(log => {
                    const type = log.activity.type;
                    activityCount[type] = (activityCount[type] || 0) + 1;
                });
                
                const data = Object.entries(activityCount).map(([type, count]) => ({
                    name: this.getActivityTypeName(type),
                    value: count
                }));
                
                const option = {
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b}: {c} ({d}%)'
                    },
                    series: [{
                        name: '活动类型',
                        type: 'pie',
                        radius: '70%',
                        data: data,
                        itemStyle: {
                            color: function(params) {
                                const colors = ['#8B7355', '#A0937D', '#D4B896', '#E0DACE'];
                                return colors[params.dataIndex % colors.length];
                            }
                        }
                    }]
                };
                
                this.charts.activity.setOption(option);
            }
            
            getActivityTypeName(type) {
                const names = {
                    'creative': '创作活动',
                    'work': '工作活动',
                    'personal': '个人活动',
                    'social': '社交活动'
                };
                return names[type] || type;
            }
            
            initMoodTrendsChart() {
                this.charts.moodTrends = echarts.init(document.getElementById('mood-trends-chart'));
            }
            
            updateMoodTrendsChart() {
                const moodValues = {
                    '愉悦': 9, '兴奋': 10, '满足': 8, '欣喜': 9,
                    '平静': 6, '安详': 7, '放松': 7, '舒适': 7,
                    '沉思': 5, '忧郁': 3, '敏感': 4, '内省': 5,
                    '专注': 7, '疲惫': 2, '倦怠': 2, '无力': 2, '沉闷': 3
                };
                
                const moodData = this.filteredLogs.slice(-20).map(log => ({
                    time: new Date(log.timestamp).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' }),
                    mood: log.mood.primary,
                    value: moodValues[log.mood.primary] || 5
                }));
                
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        formatter: function(params) {
                            const data = params[0];
                            return `${data.name}<br/>心情: ${data.data.mood}<br/>指数: ${data.value}`;
                        }
                    },
                    xAxis: {
                        type: 'category',
                        data: moodData.map(d => d.time),
                        axisLabel: { fontSize: 10 }
                    },
                    yAxis: {
                        type: 'value',
                        min: 0,
                        max: 10,
                        axisLabel: { show: false }
                    },
                    series: [{
                        data: moodData.map(d => ({ value: d.value, mood: d.mood })),
                        type: 'line',
                        smooth: true,
                        lineStyle: { color: '#D4B896' },
                        itemStyle: { color: '#8B7355' },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(212, 184, 150, 0.3)' },
                                    { offset: 1, color: 'rgba(212, 184, 150, 0.05)' }
                                ]
                            }
                        }
                    }]
                };
                
                this.charts.moodTrends.setOption(option);
            }
            
            initTimePatternChart() {
                this.charts.timePattern = echarts.init(document.getElementById('time-pattern-chart'));
            }
            
            updateTimePatternChart() {
                const hourCount = new Array(24).fill(0);
                
                this.filteredLogs.forEach(log => {
                    const hour = new Date(log.timestamp).getHours();
                    hourCount[hour]++;
                });
                
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        formatter: '{b}:00<br/>日志数量: {c}'
                    },
                    xAxis: {
                        type: 'category',
                        data: Array.from({length: 24}, (_, i) => `${i}`),
                        axisLabel: { 
                            interval: 2,
                            formatter: '{value}:00'
                        }
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [{
                        data: hourCount,
                        type: 'bar',
                        itemStyle: {
                            color: '#D4B896'
                        }
                    }]
                };
                
                this.charts.timePattern.setOption(option);
            }
            
            initWeatherImpactChart() {
                this.charts.weatherImpact = echarts.init(document.getElementById('weather-impact-chart'));
            }
            
            updateWeatherImpactChart() {
                const weatherMood = {};
                
                this.filteredLogs.forEach(log => {
                    if (log.weather) {
                        const weather = log.weather.condition;
                        if (!weatherMood[weather]) {
                            weatherMood[weather] = { total: 0, count: 0 };
                        }
                        
                        const moodValues = {
                            '愉悦': 9, '兴奋': 10, '满足': 8, '欣喜': 9,
                            '平静': 6, '安详': 7, '放松': 7, '舒适': 7,
                            '沉思': 5, '忧郁': 3, '敏感': 4, '内省': 5,
                            '专注': 7, '疲惫': 2, '倦怠': 2, '无力': 2, '沉闷': 3
                        };
                        
                        weatherMood[weather].total += moodValues[log.mood.primary] || 5;
                        weatherMood[weather].count++;
                    }
                });
                
                const data = Object.entries(weatherMood).map(([weather, data]) => ({
                    name: weather,
                    value: Math.round(data.total / data.count * 10) / 10
                }));
                
                const option = {
                    tooltip: {
                        trigger: 'axis',
                        formatter: '{b}<br/>平均心情指数: {c}'
                    },
                    xAxis: {
                        type: 'category',
                        data: data.map(d => d.name)
                    },
                    yAxis: {
                        type: 'value',
                        min: 0,
                        max: 10
                    },
                    series: [{
                        data: data.map(d => d.value),
                        type: 'bar',
                        itemStyle: {
                            color: function(params) {
                                const colors = ['#8B7355', '#A0937D', '#D4B896', '#E0DACE'];
                                return colors[params.dataIndex % colors.length];
                            }
                        }
                    }]
                };
                
                this.charts.weatherImpact.setOption(option);
            }
            
            updateStats() {
                this.elements.filteredCount.textContent = this.filteredLogs.length;
                
                // 计算平均心情
                if (this.filteredLogs.length > 0) {
                    const moodValues = {
                        '愉悦': 9, '兴奋': 10, '满足': 8, '欣喜': 9,
                        '平静': 6, '安详': 7, '放松': 7, '舒适': 7,
                        '沉思': 5, '忧郁': 3, '敏感': 4, '内省': 5,
                        '专注': 7, '疲惫': 2, '倦怠': 2, '无力': 2, '沉闷': 3
                    };
                    
                    const avgMood = this.filteredLogs.reduce((sum, log) => {
                        return sum + (moodValues[log.mood.primary] || 5);
                    }, 0) / this.filteredLogs.length;
                    
                    let moodLabel = '一般';
                    if (avgMood >= 7) moodLabel = '良好';
                    else if (avgMood >= 5) moodLabel = '稳定';
                    else moodLabel = '低落';
                    
                    this.elements.avgMood.textContent = moodLabel;
                }
                
                // 计算活跃时段
                const hourCount = new Array(24).fill(0);
                this.filteredLogs.forEach(log => {
                    const hour = new Date(log.timestamp).getHours();
                    hourCount[hour]++;
                });
                
                const maxHour = hourCount.indexOf(Math.max(...hourCount));
                let period = '夜晚';
                if (maxHour >= 6 && maxHour < 12) period = '早晨';
                else if (maxHour >= 12 && maxHour < 18) period = '下午';
                else if (maxHour >= 18 && maxHour < 22) period = '傍晚';
                
                this.elements.activePeriod.textContent = period;
            }
            
            exportData() {
                const data = {
                    exportTime: new Date().toISOString(),
                    totalLogs: this.filteredLogs.length,
                    logs: this.filteredLogs
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `virtual-character-logs-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
            }
            
            updateTimeDisplay() {
                const now = new Date();
                this.elements.currentTime.textContent = now.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                });
            }
        }
        
        // 启动历史管理器
        document.addEventListener('DOMContentLoaded', () => {
            new HistoryManager();
        });
    </script>
</body>
</html>